<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.js"></script>

    <style>
        .center {
            position: relative;
            top: 50%;
        }
    </style>
    <title></title>
</head>

<body>
    <div class="container">

        <div class="row">
            <nav class="navbar navbar-default" role="navigation">
                <a href="index.html" class="pull-left glyphicon glyphicon-chevron-left" style="margin-top:15px;margin-left:20px;"></a>
                <h4 class="text-aglin:center" style="margin-left:40%;margin-top:15px;">读圣经</h4>
            </nav>
            <div class="row" style="margin-top:50px;">
                <div class="col-md-12 column">
                    <audio id="ad" autoplay="autoplay" src="http://biblevoice.oss-cn-hangzhou.aliyuncs.com/rock/创世记第1章.mp3" controls="controls"></audio>
                    <a id="btnDownLoad" class="btn btn-primary" style="margin-top: -25px;">下载</a>
                </div>
                <div class="col-md-12 column">
                    当前正在播放 &nbsp;
                    <span id="bn"></span>
                </div>
            </div>

            <div id="bContent" class="col-md-12">

            </div>
        </div>
        <!-- title -->




        <!-- 显示经文 -->
        <div class="row">


        </div>


        <!-- mp3播放器 -->

        <!-- mp3下载 -->

    </div>

    <script>
        $(document).ready(function () {
           
            /* 经文加载 */
            if (bn.indexOf(";") > 0) {
                bnArr = bn.split(';')
                for (var i = 0; i < bnArr.length; i++) {
                    bookname = bnArr[i].replace(/[^\u4e00-\u9fa5]/gi, "")
                    startCharpter = bnArr[i].replace(bookname, "").split("-")[0]
                    endCharpter = bnArr[i].replace(bookname, "").split("-")[1]
                    
                }
            }
            else {
                bookname = bn.replace(/[^\u4e00-\u9fa5]/gi, "")
                console.log(bookname)
                startCharpter = bn.replace(bookname, "").split("-")[0]
                endCharpter = bn.replace(bookname, "").split("-")[1]
               
                for (key in bsn) {
                    if (bookname == key) {
                        bookname = bookname.replace(key, bsn[key])
                     
                        for (var j = parseInt(startCharpter); j <= parseInt(endCharpter); j++) {
                         
                            if (endCharpter == 1) {
                                srcArr.push(url + bookname + "第" + startCharpter + "章.mp3")
                            }
                            else {
                                srcArr.push(url + bookname + "第" + (startCharpter++) + "章.mp3")
                            }
                        }
                    }
                }
            }
            document.title = srcArr[0].replace("http://biblevoice.oss-cn-hangzhou.aliyuncs.com/rock/", "")
            $("#bn").text(srcArr[0].replace("http://biblevoice.oss-cn-hangzhou.aliyuncs.com/rock/", ""))

            $("#ad").attr("src", srcArr[0])
            $("#btnDownLoad").click(function () { $("#btnDownLoad").attr("href", $("#ad").attr("src")) })
            inx = 1;
            $("#ad").on("ended", function () {
                if (inx >= srcArr.length) {
                    inx = 0
                }
                /*  inx=inx+1 */
                $(this).attr("src", srcArr[inx++])
                ts = srcArr[inx]
                title = ts.substring(ts.lastIndexOf("rock/") + 5)
                $("#bn").text(title)
                document.title = title
                var player = $("#ad")[0]; /*jquery对象转换成js对象*/
                if (player.paused) { /*如果已经暂停*/
                    player.play(); /*播放*/
                } else {
                    player.pause();/*暂停*/
                }
            })
        })


        function bsToEnd(startCharpter, endCharpter){
            for (key in bsn) {
                if (bookname == key) {
                    bookname = bookname.replace(key, bsn[key])

                    for (var j = startCharpter; j <= endCharpter; j++) {
                        if (endCharpter == 1) {
                            srcArr.push(url + bookname + "第" + startCharpter + "章.mp3")
                        }
                        else {
                            srcArr.push(url + bookname + "第" + (startCharpter++) + "章.mp3")
                        }
                    }
                }
            }
        }
    </script>
</body>

</html>